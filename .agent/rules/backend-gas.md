# Правила разработки Backend (Google Apps Script)

## Точки входа (API)
- **doGet(e)**: Обработка всех GET-запросов. Используется для получения данных и отдачи HTML-интерфейса.
- **doPost(e)**: Обработка всех POST-запросов. Используется для создания, обновления и удаления данных.

## Формат ответа
Все ответы API должны возвращаться в формате JSON:
```javascript
function returnJson(data) {
  return ContentService.createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}
```

## Работа с Google Sheets
- **Оптимизация**: Всегда минимизируйте количество вызовов API SpreadsheetApp.
- **Batch Operations**: Используйте `getValues()` и `setValues()` для чтения/записи массивов данных целиком вместо работы с отдельными ячейками.
- **Кеширование**: Используйте `CacheService` для хранения часто запрашиваемых данных, которые редко меняются.

## Структура кода
- Разделение логики: выносите бизнес-логику в отдельные функции/файлы, оставляя `doGet`/`doPost` только как маршрутизаторы.
- Обработка ошибок: Обязательное использование блоков `try...catch` с возвратом понятного JSON-ответа об ошибке клиенту.

## Триггеры
- Использование триггеров (по времени или по изменению таблицы) для автоматических пересчетов (например, бонусов в реферальной системе).
